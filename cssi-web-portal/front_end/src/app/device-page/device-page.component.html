<mat-sidenav-container class="sidenav-container">
  <mat-sidenav
    #drawer
    class="sidenav"
    fixedInViewport="false"
    [mode]="'over'"
    [opened]="false"
  >
    <mat-toolbar class="sidenav-toolbar"
      ><p class="sidenav-title">Menu</p></mat-toolbar
    >
    <mat-nav-list>
      <button class="absorb" mat-button></button>
      <!--That button is needed to fix Angular bug where 1st element will always be highlighted in sidenav if it is in over mode-->
      <a mat-list-item href="#">Link 1</a>
      <a mat-list-item href="#">Link 2</a>
      <a mat-list-item href="#">Link 3</a>
    </mat-nav-list>
  </mat-sidenav>
  <mat-sidenav-content>
    <mat-toolbar color="primary" class="toolbar">
      <button
        type="button"
        aria-label="Toggle sidenav"
        mat-icon-button
        (click)="drawer.toggle()"
      >
        <mat-icon aria-label="Side nav toggle icon">menu</mat-icon></button
      ><a routerLink="/home" class="color-white">Home ></a>
      <a routerLink="/organization" class="color-white">Organization ></a>
      <a routerLink="/application" class="color-white">Application </a> >
      Device</mat-toolbar
    >
    <body class="background">
      <mat-card class="device-box">
        <mat-card-content class="device-content">
          <img
            class="device-image"
            src="../../assets/placeholder_cat2.jpg"
            alt="Grey cat sitting on couch"
          />
          <mat-card-content class="about-device-box">
            <mat-card-header
              ><h3 class="device-title">About Cat Device</h3>
            </mat-card-header>
            <mat-divider class="device-divider"></mat-divider>
            <p>
              This is the device that the cat owns, so we must consider how much
              it data it has and can display.
            </p>
          </mat-card-content>
        </mat-card-content>
      </mat-card>
      <mat-card class="device-data-box">
        <mat-card-content class="device-data">
          <mat-accordion class="search-bar">
            <mat-expansion-panel
              class="search-expansion-box"
              (opened)="panelOpenState = true"
              (closed)="panelOpenState = false"
            >
              <!--This block indicates if the panel is open or not and adjusts the variable panelOpenState to the appropriate state-->
              <mat-expansion-panel-header>
                <mat-panel-title> View the data here! </mat-panel-title>
                <mat-panel-description>
                  {{
                    panelOpenState
                      ? "This is all the data of the device."
                      : "Click me!"
                  }}
                </mat-panel-description>
              </mat-expansion-panel-header>
              <img
                src="../../assets/placeholder_cat.jfif"
                alt="Grey cat sitting on couch"
              />
              <mat-card class="payload-table">
                <!-- Filters need to be reintroduced into the tables when I can reliably display data -->
                <!-- Filters need to be refined further -->

                <!-- Filter for Payload -->
                <mat-form-field>
                  <mat-label>Filter</mat-label>
                  <input
                    matInput
                    (keyup)="applyPayloadFilter($event)"
                    placeholder="Dev_eui"
                    #input
                  />
                </mat-form-field>

                <!--  Payload Table -->
                <p>Payload Table</p>
                <table
                  mat-table
                  [dataSource]="payloadDataSource"
                  class="mat-elevation-z8"
                >
                  <!-- Dev_eui Column -->
                  <ng-container matColumnDef="Dev_eui" class="dev_eui">
                    <th mat-header-cell *matHeaderCellDef>dev_eui</th>
                    <td mat-cell *matCellDef="let element">
                      {{ element.dev_eui }}
                    </td>
                  </ng-container>

                  <!-- Dev_time Column -->
                  <ng-container matColumnDef="Dev_time" class="dev_time">
                    <th mat-header-cell *matHeaderCellDef>dev_time</th>
                    <td mat-cell *matCellDef="let element">
                      {{ element.dev_time }}
                    </td>
                  </ng-container>

                  <!-- Payload Columns / Dynamic -->
                  <ng-container
                    *ngFor="let column of payloadColumns"
                    [matColumnDef]="column"
                    class="dynamic_column"
                  >
                    <th mat-header-cell *matHeaderCellDef>{{ column }}</th>
                    <td mat-cell *matCellDef="let element">
                      {{ element.payload_dict[column] }}
                    </td>
                  </ng-container>

                  <tr
                    mat-header-row
                    *matHeaderRowDef="
                      ['Dev_eui', 'Dev_time'].concat(payloadColumns)
                    "
                  ></tr>
                  <tr
                    mat-row
                    *matRowDef="
                      let row;
                      columns: ['Dev_eui', 'Dev_time'].concat(payloadColumns)
                    "
                  ></tr>

                  <tr class="mat-row" *matNoDataRow>
                    <td class="mat-cell" colspan="4">
                      No data matching the filter "{{ input.value }}"
                    </td>
                  </tr>
                </table>

                <mat-paginator
                  #payloadPaginator
                  [pageSizeOptions]="[5, 10, 20]"
                  showFirstLastButtons
                  aria-label="Select page of Payload Data"
                ></mat-paginator>

                <button (click)="exportPayloadData()">
                  Export Payload Data
                </button>
              </mat-card>

              <!-- payload graph -->
              <mat-card class="graph">
                <mat-accordion class="search-bar">
                  <mat-expansion-panel
                    class="search-expansion-box"
                    (opened)="panelOpenStatePayloadGraph = true"
                    (closed)="panelOpenStatePayloadGraph = false"
                  >
                    <!--This block indicates if the panel is open or not and adjusts the variable panelOpenState to the appropriate state-->
                    <mat-expansion-panel-header>
                      <mat-panel-title> Payload Graph! </mat-panel-title>
                      <mat-panel-description>
                        {{
                          panelOpenState
                            ? "Choose the parameters you'd like to view"
                            : "Click me!"
                        }}
                      </mat-panel-description>
                    </mat-expansion-panel-header>
                    <!-- code here -->
                    <mat-card class="chart">
                      <canvas id="payloadChart"></canvas>
                    </mat-card>
                  </mat-expansion-panel>
                </mat-accordion>
              </mat-card>

              <mat-card class="metadata-table">
                <!-- Filter for Metadata -->
                <mat-form-field>
                  <mat-label>Filter</mat-label>
                  <input
                    matInput
                    (keyup)="applyMetadataFilter($event)"
                    placeholder="Dev_eui"
                    #input
                  />
                </mat-form-field>

                <!--  Metadata Table -->
                <p>Metadata Table</p>
                <table
                  mat-table
                  [dataSource]="metadataSource"
                  class="mat-elevation-z8"
                >
                  <!-- Dev_eui Column -->
                  <ng-container matColumnDef="Dev_eui" class="dev_eui">
                    <th mat-header-cell *matHeaderCellDef>dev_eui</th>
                    <td mat-cell *matCellDef="let element">
                      {{ element.dev_eui }}
                    </td>
                  </ng-container>

                  <!-- Dev_time Column -->
                  <ng-container matColumnDef="Dev_time" class="dev_time">
                    <th mat-header-cell *matHeaderCellDef>dev_time</th>
                    <td mat-cell *matCellDef="let element">
                      {{ element.dev_time }}
                    </td>
                  </ng-container>

                  <!-- Metadata Columns / Dynamic -->
                  <ng-container
                    *ngFor="let column of metadataColumns"
                    [matColumnDef]="column"
                    class="dynamic_column"
                  >
                    <th mat-header-cell *matHeaderCellDef>{{ column }}</th>
                    <td mat-cell *matCellDef="let element">
                      {{ element.metadata_dict[column] }}
                    </td>
                  </ng-container>

                  <tr
                    mat-header-row
                    *matHeaderRowDef="
                      ['Dev_eui', 'Dev_time'].concat(metadataColumns)
                    "
                  ></tr>
                  <tr
                    mat-row
                    *matRowDef="
                      let row;
                      columns: ['Dev_eui', 'Dev_time'].concat(metadataColumns)
                    "
                  ></tr>

                  <tr class="mat-row" *matNoDataRow>
                    <td class="mat-cell" colspan="4">
                      No data matching the filter "{{ input.value }}"
                    </td>
                  </tr>
                </table>

                <mat-paginator
                  #metadataPaginator
                  [pageSizeOptions]="[5, 10, 20]"
                  showFirstLastButtons
                  aria-label="Select page of Metadata Data"
                ></mat-paginator>

                <button (click)="exportMetadata()">Export Metadata Data</button>
              </mat-card>
              <!-- metadata graph -->
              <mat-card class="graph">
                <mat-accordion class="search-bar">
                  <mat-expansion-panel
                    class="search-expansion-box"
                    (opened)="panelOpenStateMetadataGraph = true"
                    (closed)="panelOpenStateMetadataGraph = false"
                  >
                    <!--This block indicates if the panel is open or not and adjusts the variable panelOpenState to the appropriate state-->
                    <mat-expansion-panel-header>
                      <mat-panel-title> Metadata Graph </mat-panel-title>
                      <mat-panel-description>
                        {{
                          panelOpenState
                            ? "Choose the parameters you'd like to view"
                            : "Click me!"
                        }}
                      </mat-panel-description>
                    </mat-expansion-panel-header>
                    <!-- code here -->
                    <mat-card class="chart">
                      <canvas id="metadataChart"></canvas>
                    </mat-card>
                  </mat-expansion-panel>
                </mat-accordion>
              </mat-card>
            </mat-expansion-panel>
          </mat-accordion>
        </mat-card-content>
      </mat-card>
      <button
        mat-raised-button
        color="accent"
        class="data-button"
        [routerLink]="['/filter', appId]"
      >
        Filter Device Data
      </button>
      <button
      mat-raised-button
      color="accent"
      class="map-button"
      [routerLink]="['/map']"
    >
      Check Map
    </button>
    </body>
  </mat-sidenav-content>
</mat-sidenav-container>
